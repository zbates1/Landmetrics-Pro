<!DOCTYPE html>
<html>
<head>
    <title>New Test</title>
</head>
<body>
    <h1>New Test</h1>
    <button onclick="startTest()">Start Test</button>
    <button onclick="stopTest()">Stop Test</button>
    <button onclick="uploadData()">Upload Data</button>
    <h3>Data Stream:</h3>
    <div id="data"></div>

    <script>
        function startTest() {
            fetch("/start_test", { method: "POST" });
        }

        function stopTest() {
            fetch("/stop_test", { method: "POST" });
        }

        function uploadData() {
            fetch("/upload_csv", { method: "POST" })
                .then((response) => response.json())
                .then((data) => alert(data.message))
                .catch((error) => console.error("Error:", error));
        }

        function fetchData() {
            fetch("/stream_data")
                .then((response) => response.json())
                .then((data) => {
                    document.getElementById("data").innerText = data.join("\n");
                    fetchData(); // Trigger the next fetch immediately
                })
                .catch((error) => {
                    console.error("Error fetching data:", error);
                    setTimeout(fetchData, 100); // Retry after a short delay in case of an error
                });
        }

        // Start the real-time data fetching
        fetchData();
    </script>
</body>
</html>
