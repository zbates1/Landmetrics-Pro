{% extends "base.html" %}

{% block title %}Landmetrics Pro Data Visualization{% endblock %}

{% block content %}
<h1>Landmetrics Pro Data Visualization</h1>

<!-- Dropdown to select the type of graph -->
<select id="graphType" class="custom-select" onchange="updateGraph()">
  <option value="line">Line Chart</option>
  <option value="bar">Bar Chart</option>
</select>

<canvas id="userDataChart"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    updateGraph('line'); // Ensures the graph initializes as a line chart on page load
  });

function updateGraph(selectedType) {
    const ctx = document.getElementById('userDataChart').getContext('2d');
    const graphType = selectedType || document.getElementById('graphType').value;
    const chartData = {
      labels: [1, 2, 3, 4, 5],
      datasets: [{
        label: 'Sample Data 1',
        data: {{ sample_array_1 | tojson }},
        borderColor: 'rgb(75, 192, 192)',
        backgroundColor: 'rgba(75, 192, 192, 0.5)',
        tension: 0.1,
        fill: graphType === 'line' ? false : true
      }, {
        label: 'Sample Data 2',
        data: {{ sample_array_2 | tojson }},
        borderColor: 'rgb(255, 99, 132)',
        backgroundColor: 'rgba(255, 99, 132, 0.5)',
        tension: 0.1,
        fill: graphType === 'line' ? false : true
      }]
    };

    // Clear existing canvas to redraw
    if (window.userDataChart && typeof window.userDataChart.destroy === 'function') {
        window.userDataChart.destroy();
    }

    window.userDataChart = new Chart(ctx, {
      type: graphType,
      data: chartData,
      options: {
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });
}

</script>

<button id="downloadGraph" class="btn btn-primary">Download Graph</button>
<script>
  document.getElementById('downloadGraph').addEventListener('click', function() {
    const url = window.userDataChart.toBase64Image();
    const link = document.createElement('a');
    link.download = 'userDataChart.png';
    link.href = url;
    link.click();
  });
</script>

<button id="downloadData" class="btn btn-secondary">Download Data</button>
<script>
  document.getElementById('downloadData').addEventListener('click', function() {
    const data = {
      SampleData1: {{ sample_array_1 | tojson }},
      SampleData2: {{ sample_array_2 | tojson }}
    };
    const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(data));
    const link = document.createElement('a');
    link.download = 'userData.json';
    link.href = dataStr;
    link.click();
  });
</script>

{% endblock %}
